---
# GPS initialization role

- name: Deploy gps-init script to device
  ansible.builtin.template:
    src: gps-init.j2
    dest: /etc/init.d/gps-init
    mode: '0755'
    owner: root
    group: root
  tags:
    - gps

- name: Check if GPS init script is already enabled
  ansible.builtin.stat:
    path: /etc/rc.d/S15gps-init
  register: gps_init_enabled
  tags:
    - gps

- name: Enable GPS init script to run at boot
  ansible.builtin.command:
    cmd: /etc/init.d/gps-init enable
  when: not gps_init_enabled.stat.exists
  register: gps_enable_result
  changed_when: gps_enable_result.rc == 0
  failed_when: gps_enable_result.rc != 0
  tags:
    - gps

- name: Check GPS init script status
  ansible.builtin.command:
    cmd: /etc/init.d/gps-init status
  register: gps_status
  changed_when: false
  failed_when: false
  tags:
    - gps

- name: Display GPS status
  ansible.builtin.debug:
    msg: "{{ gps_status.stdout_lines }}"
  tags:
    - gps

